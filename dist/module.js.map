{"version":3,"sources":["../src/module.js"],"names":["_","MetricsPanelCtrl","kbn","TimeSeries","legend","$","BarChartCtrl","$scope","$injector","$rootScope","panelDefaults","show","values","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendTable","aliasColors","format","valueName","yaxis","label","tickDecimals","xaxis","decimals","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","value","render","series","data","parseSeries","_this2","s","map","serie","i","target","ticks","datapoints","d","push","color","alias","colors","dataList","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","scope","elem","attrs","ctrl","_this","find","$tooltip","renderingCompleted","setElementHeight","height","row","isString","parseInt","replace","title","css","e","processOffsetHook","plot","gridMargin","left","right","drawHook","yaxisLabel","text","appendTo","style","marginTop","addBarChart","width","min","plotCanvas","plotCss","top","margin","position","$panelContainer","parents","backgroundColor","html","plotSeries","origData","bars","align","fill","barWidth","zero","lineWidth","options","hooks","draw","processOffset","tickFormatter","val","axis","formatValue","shadowSize","grid","minBorderMargin","markings","borderWidth","hoverable","selection","mode","stack","event","pos","item","detach","body","formatted","place_tt","pageX","pageY","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from \"lodash\";\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\nimport kbn from \"app/core/utils/kbn\";\nimport TimeSeries from \"app/core/time_series\";\nimport legend from './legend';\nimport './barchart-panel.css!';\nimport $ from \"jquery\";\nimport \"jquery.flot\";\n\nexport class BarChartCtrl extends MetricsPanelCtrl {\n\n    constructor($scope, $injector, $rootScope) {\n        super($scope, $injector);\n        this.$rootScope = $rootScope;\n\n        var panelDefaults = {\n            legend: {\n                show: true, // disable/enable legend\n                values: true\n            },\n            links: [],\n            datasource: null,\n            maxDataPoints: 3,\n            interval: null,\n            targets: [{}],\n            cacheTimeout: null,\n            nullPointMode: 'connected',\n            legendTable: false,\n            aliasColors: {},\n            format: 'short',\n            valueName: 'current',\n            yaxis: {\n                label: null,\n                show: true,\n                tickDecimals: 2\n            },\n            xaxis: {\n                show: true\n            },\n            decimals: 2\n        };\n\n        _.defaults(this.panel, panelDefaults);\n        _.defaults(this.panel.legend, panelDefaults.legend);\n\n        this.events.on('render', this.onRender.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Axes', 'public/plugins/grafana-barchart-panel/axes.html');\n        this.addEditorTab('Options', 'public/plugins/grafana-barchart-panel/editor.html');\n        this.unitFormats = kbn.getUnitFormats();\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    onDataError() {\n        this.series = [];\n        this.render();\n    }\n\n    onRender() {\n        this.data = this.parseSeries(this.series);\n    }\n\n    parseSeries(series) {\n    \tvar _this2 = this;\n                        \n\t\t/*\n\t\t\tSample data\n\t\t[\n\t\t{\"target\":\"label\",\"datapoints\":[[\"c1\",1510595650453],[\"c2\",1510595650454],[\"c3\",1510595650455],[\"c4\",1510595650456]],},\n\t\t{\"target\":\"opens\",\"datapoints\":[[0.193,1510595650453],[0.193,1510595650454],[0.193,1510595650455],[0.193,1510595650456]]}\n\t\t,{\"target\":\"clicks\",\"datapoints\":[[0.456,1510595650453],[0.456,1510595650454],[0.456,1510595650455],[0.456,1510595650456]]}]\n\t\t*/\n\t\tvar s=[];\n\t\t\n\t\t_.map(this.series, function (serie, i) {\n\t\t\tif (serie.target=='label'){_this2.ticks=serie.datapoints.map((d,i)=>[i,d[0]]); return;}\n\t\t\ts.push({\n\t\t\t\tlabel:serie.target,\n\t\t\t\tdata:serie.datapoints.map((d,i)=>[i,d[0]]),\n\t\t\t\tcolor: _this2.panel.aliasColors[serie.alias] || _this2.$rootScope.colors[i]\n\t\t\t});\n\t\t});\n\t\treturn s;\n    }\n\n    onDataReceived(dataList) {\n\t\t this.series = dataList;\n\t\tthis.data = this.parseSeries(this.series);\n\t\tthis.render(this.data);\n    }\n\n    getDecimalsForValue(value) {\n        if (_.isNumber(this.panel.decimals)) {\n            return {decimals: this.panel.decimals, scaledDecimals: null};\n        }\n\n        var delta = value / 2;\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n        var magn = Math.pow(10, -dec);\n        var norm = delta / magn; // norm is between 1.0 and 10.0\n        var size;\n\n        if (norm < 1.5) {\n            size = 1;\n        } else if (norm < 3) {\n            size = 2;\n            // special case for 2.5, requires an extra decimal\n            if (norm > 2.25) {\n                size = 2.5;\n                ++dec;\n            }\n        } else if (norm < 7.5) {\n            size = 5;\n        } else {\n            size = 10;\n        }\n\n        size *= magn;\n\n        // reduce starting decimals if not needed\n        if (Math.floor(value) === value) {\n            dec = 0;\n        }\n\n        var result = {};\n        result.decimals = Math.max(0, dec);\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n        return result;\n    }\n\n    formatValue(value) {\n        var decimalInfo = this.getDecimalsForValue(value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        if (formatFunc) {\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        }\n        return value;\n    }\n\n    link(scope, elem, attrs, ctrl) {\n    \tvar _this=this;\n        var data, panel;\n\n        elem = elem.find('.barchart-panel');\n        var $tooltip = $('<div id=\"tooltip\">');\n\n        ctrl.events.on('render', function () {\n            render();\n            ctrl.renderingCompleted();\n        });\n\n        function setElementHeight() {\n            try {\n                var height = ctrl.height || panel.height || ctrl.row.height;\n                if (_.isString(height)) {\n                    height = parseInt(height.replace('px', ''), 10);\n                }\n\n                height -= 5; // padding\n                height -= panel.title ? 24 : 9; // subtract panel title bar\n\n                elem.css('height', height + 'px');\n\n                return true;\n            } catch (e) { // IE throws errors sometimes\n                return false;\n            }\n        }\n\n        function processOffsetHook(plot, gridMargin) {\n            var left = panel.yaxis;\n            var right = panel.yaxis;\n            if (left.show && left.label) { gridMargin.left = 20; }\n            if (right.show && right.label) { gridMargin.right = 20; }\n        }\n\n        function drawHook(plot) {\n             // add left axis labels\n            if (panel.yaxis.label) {\n                var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n                    .text(panel.yaxis.label)\n                    .appendTo(elem);\n\n                yaxisLabel[0].style.marginTop = (elem.height() / 6) + 'px';\n            }\n        }\n\n\t\tfunction addBarChart() {\n\t\t\t\n\t\t\tvar width = elem.width();\n\t\t\tvar height = elem.height();\n\n\t\t\tvar size = Math.min(width, height);\n\n\t\t\tvar plotCanvas = $('<div></div>');\n\t\t\tvar plotCss = {\n\t\t\t\ttop: '10px',\n\t\t\t\tmargin: 'auto',\n\t\t\t\tposition: 'relative',\n\t\t\t\theight: size - 20 + 'px'\n\t\t\t};\n\n\t\t\tplotCanvas.css(plotCss);\n\n\t\t\tvar $panelContainer = elem.parents('.panel-container');\n\t\t\tvar backgroundColor = $panelContainer.css('background-color');\n\n\t\t\telem.html(plotCanvas);\n\t   \n\t\t\tvar plotSeries=_.map(data, function (origData, i) {\n\t\t\t\n\t\t\t\treturn {\n\t\t\t\t\tlabel: origData.label,\n\t\t\t\t\tdata: origData.data,\n\t\t\t\t\tcolor: origData.color,\n\t\t\t\t\tbars: {\n\t\t\t\t\t\tshow: true,\n\t\t\t\t\t\talign: 'center',\n\t\t\t\t\t\tfill: 1,\n\t\t\t\t\t\tbarWidth: 0.7,\n\t\t\t\t\t\tzero: true,\n\t\t\t\t\t\tlineWidth: 0\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar options = {\n\t\t\t\thooks: {\n\t\t\t\t\tdraw: [drawHook],\n\t\t\t\t\tprocessOffset: [processOffsetHook]\n\t\t\t\t},\n\t\t\t\tlegend: {\n\t\t\t\t\tshow: false\n\t\t\t\t},\n\t\t\t\txaxis: {\n\t\t\t\t\tticks: _this.ticks,\n\t\t\t\t\tshow: panel.xaxis.show\n\t\t\t\t},\n\t\t\t\tyaxis: {\n\t\t\t\t\tshow: panel.yaxis.show,\n\t\t\t\t\ttickFormatter: function tickFormatter(val, axis) {\n\t\t\t\t\t\treturn ctrl.formatValue(val);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tshadowSize: 0,\n\t\t\t\tgrid: {\n\t\t\t\t\tminBorderMargin: 0,\n\t\t\t\t\tmarkings: [],\n\t\t\t\t\tbackgroundColor: backgroundColor,\n\t\t\t\t\tborderWidth: 0,\n\t\t\t\t\thoverable: true,\n\t\t\t\t\tcolor: '#c8c8c8',\n\t\t\t\t\tmargin: { left: 0, right: 0 }\n\t\t\t\t},\n\t\t\t\tselection: {\n\t\t\t\t\tmode: \"x\",\n\t\t\t\t\tcolor: '#666'\n\t\t\t\t},\n\t\t\t\tseries:{\n\t\t\t\t\tstack:false\n\t\t\t\t}\n\t\t\t};\n\t\n\t\t\n\t\t\t$.plot(plotCanvas, plotSeries, options);\n\t\t\tplotCanvas.bind(\"plothover\", function (event, pos, item) {\n\t\t\t\tif (!item) {\n\t\t\t\t\t$tooltip.detach();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar body;\n\t\t\t\tvar formatted = ctrl.formatValue(item.series.data[0][1]);\n\n\t\t\t\tbody = '<div class=\"graph-tooltip-small\"><div class=\"graph-tooltip-time\">';\n\t\t\t\tbody += '<div class=\"graph-tooltip-value\">' + item.series.label + ': ' + formatted;\n\t\t\t\tbody += '</div>';\n\t\t\t\tbody += \"</div></div>\";\n\t\t\t\t$tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n\t\t\t});\n\t\t}\n\n\n        function render() {\n            if (!ctrl.data) {\n                return;\n            }\n\n            data = ctrl.data;\n            panel = ctrl.panel;\n\n            if (setElementHeight()) {\n                addBarChart();\n            }\n        }\n    }\n}\n\nBarChartCtrl.templateUrl = 'module.html';\n\nexport {\n    BarChartCtrl as PanelCtrl\n};\n\n"]}