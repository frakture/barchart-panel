{"version":3,"sources":["../src/legend.js"],"names":["angular","_","$","module","directive","link","scope","elem","$container","firstRender","ctrl","panel","seriesList","i","events","on","map","series","serie","target","push","label","color","length","render","append","empty","tableLayout","legendTable","legend","values","toggleClass","header","hideEmpty","allIsNull","html","valueName","formatValue","stats"],"mappings":";;;;;;;;;AAAOA,a;;AACAC,O;;AACAC,O;;;;AAIPF,cAAQG,MAAR,CAAe,oBAAf,EAAqCC,SAArC,CAA+C,gBAA/C,EAAiE,YAAW;AAC1E,eAAO;AACLC,gBAAM,cAASC,KAAT,EAAgBC,IAAhB,EAAsB;AAC1B,gBAAIC,aAAaN,EAAE,0CAAF,CAAjB;AACA,gBAAIO,cAAc,IAAlB;AACA,gBAAIC,OAAOJ,MAAMI,IAAjB;AACA,gBAAIC,QAAQD,KAAKC,KAAjB;;AAEA,gBAAIC,UAAJ;AACA,gBAAIC,CAAJ;;AAEAH,iBAAKI,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAY;AACzCH,2BAAW,EAAX;AACAX,gBAAEe,GAAF,CAAMN,KAAKO,MAAL,IAAc,EAApB,EAAwB,UAAUC,KAAV,EAAiBL,CAAjB,EAAoB;AAC3C,oBAAIK,MAAMC,MAAN,IAAc,OAAlB,EAA0B;AAAC;AAAO;AAClCP,2BAAWQ,IAAX,CAAgB,EAACC,OAAMH,MAAMG,KAAb,EAAmBC,OAAMJ,MAAMI,KAA/B,EAAhB;AACA,eAHD;;AAKE,kBAAIV,cAAcA,WAAWW,MAAX,GAAkB,CAApC,EAAuC;AACxCC;AACE;AACH,aAVI;;AAYA,qBAASA,MAAT,GAAkB;AAChB,kBAAIf,WAAJ,EAAiB;AACfF,qBAAKkB,MAAL,CAAYjB,UAAZ;AACAC,8BAAc,KAAd;AACD;;AAGDD,yBAAWkB,KAAX;;AAEA,kBAAIC,cAAchB,MAAMiB,WAAN,IAAqBjB,MAAMkB,MAAN,CAAaC,MAApD;;AAEAtB,yBAAWuB,WAAX,CAAuB,oBAAvB,EAA6CJ,WAA7C;;AAEA,kBAAIA,WAAJ,EAAiB;AACf,oBAAIK,SAAS,mDAAb;AACA,oBAAIrB,MAAMkB,MAAN,CAAaC,MAAjB,EAAyB;AACvBE,4BAAU,2BAAV;AACD;AACDA,0BAAU,OAAV;AACAxB,2BAAWiB,MAAX,CAAkBvB,EAAE8B,MAAF,CAAlB;AACD;;AAED,mBAAKnB,IAAI,CAAT,EAAYA,IAAID,WAAWW,MAA3B,EAAmCV,GAAnC,EAAwC;AACtC,oBAAII,SAASL,WAAWC,CAAX,CAAb;;AAEA;AACA,oBAAIF,MAAMkB,MAAN,CAAaI,SAAb,IAA0BhB,OAAOiB,SAArC,EAAgD;AAC9C;AACD;AACD;AACA,oBAAI,CAACjB,OAAOY,MAAZ,EAAoB;AAClB;AACD;;AAED,oBAAIM,OAAO,iCAAX;AACAA,wBAAQ,0BAA0BtB,CAA1B,GAA8B,IAAtC;AACAsB,wBAAQ,6CAAR;AACAA,wBAAQ,yCAAyClB,OAAOK,KAAhD,GAAwD,QAAhE;AACAa,wBAAQ,SAAR;;AAEAA,wBAAQ,8CAAR;AACAA,wBAAQ,2BAA2BlB,OAAOI,KAAlC,GAA0C,MAAlD;AACAc,wBAAQ,SAAR;;AAEA,oBAAIxB,MAAMkB,MAAN,CAAaC,MAAjB,EAAyB;AACvBK,0BAAQ,+CAA6CzB,KAAKC,KAAL,CAAWyB,SAAxD,GAAkE,IAAlE,GAAyEnB,OAAOoB,WAAP,CAAmBpB,OAAOqB,KAAP,CAAa5B,KAAKC,KAAL,CAAWyB,SAAxB,CAAnB,CAAzE,GAAkI,QAA1I;AACD;;AAEDD,wBAAQ,QAAR;AACA3B,2BAAWiB,MAAX,CAAkBvB,EAAEiC,IAAF,CAAlB;AACD;AACF;AACF;AA1EI,SAAP;AA4ED,OA7ED","file":"legend.js","sourcesContent":["import angular from 'angular';\nimport _ from  'lodash';\nimport $ from  'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.time';\n\nangular.module('grafana.directives').directive('barchartLegend', function() {\n  return {\n    link: function(scope, elem) {\n      var $container = $('<section class=\"graph-legend\"></section>');\n      var firstRender = true;\n      var ctrl = scope.ctrl;\n      var panel = ctrl.panel;\n      \n      var seriesList;\n      var i;\n\n      ctrl.events.on('render', function () {\n\t\tseriesList=[];\n\t\t_.map(ctrl.series ||[], function (serie, i) {\n\t\t\tif (serie.target=='label'){return}\n\t\t\tseriesList.push({label:serie.label,color:serie.color}); \n\t\t});\n\t\t\n\t\t  if (seriesList && seriesList.length>0) {\n\t\t\trender();\n\t\t  }\n\t});\n\n      function render() {\n        if (firstRender) {\n          elem.append($container);\n          firstRender = false;\n        }\n\n        \n        $container.empty();\n\n        var tableLayout = panel.legendTable && panel.legend.values;\n\n        $container.toggleClass('graph-legend-table', tableLayout);\n\n        if (tableLayout) {\n          var header = '<tr><th colspan=\"2\" style=\"text-align:left\"></th>';\n          if (panel.legend.values) {\n            header += '<th class=\"pointer\"></th>';\n          }\n          header += '</tr>';\n          $container.append($(header));\n        }\n\n        for (i = 0; i < seriesList.length; i++) {\n          var series = seriesList[i];\n\n          // ignore empty series\n          if (panel.legend.hideEmpty && series.allIsNull) {\n            continue;\n          }\n          // ignore series excluded via override\n          if (!series.legend) {\n            continue;\n          }\n\n          var html = '<div class=\"graph-legend-series';\n          html += '\" data-series-index=\"' + i + '\">';\n          html += '<span class=\"graph-legend-icon no-pointer\">';\n          html += '<i class=\"fa fa-minus\" style=\"color:' + series.color + '\"></i>';\n          html += '</span>';\n\n          html += '<span class=\"graph-legend-alias no-pointer\">';\n          html += '<a class=\"no-pointer\">' + series.label + '</a>';\n          html += '</span>';\n\n          if (panel.legend.values) {\n            html += '<div class=\"graph-legend-value no-pointer '+ctrl.panel.valueName+'\">' + series.formatValue(series.stats[ctrl.panel.valueName]) + '</div>';\n          }\n\n          html += '</div>';\n          $container.append($(html));\n        }\n      }\n    }\n  };\n});\n\n\n"]}